<%# navigation styled for Bootstrap 3.0 %>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<div class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <%= link_to "What's Going On?", "/", class: 'navbar-brand' %>
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
      </button>
  </div>
  <div class="navbar-collapse collapse" id="navbar-main">
    <ul class="nav navbar-nav">
        <% if user_signed_in? %>
        <li><%= link_to "Friends", friends_path %></li>
        <li><%= link_to "Groups", groups_path %></li>
        <li><%= link_to 'My Account', current_user %></li>
        <% else %>
        <% end %>
    </ul>
<script>
  function acceptFriend(friendId) {
    $.ajax({  
        type: 'POST',  
        url: '/group_members/accept', 
        data: { friend_id: friendId },
        success: function() {
          location.reload(true);
        }
    });
    location.reload(true);
  }

  function rejectFriend(friendId) {
    $.ajax({  
        type: 'POST',  
        url: '/group_members/reject', 
        data: { friend_id: friendId },
        success: function() {
          location.reload(true);
        }
    });
    location.reload(true);
  }
</script>
    <ul class="nav navbar-nav navbar-right">
      <% if user_signed_in? %>
      <!-- <li><%= link_to current_user.name, current_user %></li> -->
        <% notifs = GroupMember.notifications current_user.id %>

         <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Notifications <% if notifs.size > 0 %>(<%= notifs.size.to_s %>) <% end %><b class="caret"></b></a>
              <ul class="dropdown-menu">
                 <% notifs.each do |pend| %>
                  <li class="user-notification-block">
                    <p>
                    <%= pend[1] %> wants to add you.
                    <div class="btn-group request-buttons-left-padding">
                      <button type="button" class="btn btn-success" onclick="acceptFriend(<%= pend[0] %>);">Accept</button>
                      <button type="button" class="btn btn-danger" onclick="rejectFriend(<%= pend[0] %>);">Reject</button>
                    </div>
                    </p>
                  </li>
                <% end %>
              </ul>
        </li>


      <li><%= link_to "Logout", destroy_user_session_path %></li>
      <% else %>
      <li><%= link_to "Sign in", new_user_session_path %></li>
      <% end %>
  </ul>

</div>
</div>
</div>
